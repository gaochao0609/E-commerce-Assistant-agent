# Operations Dashboard é¡¹ç›®è¿è¡ŒæŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¶æ„è¯´æ˜

è¿™ä¸ªé¡¹ç›®ç°åœ¨é‡‡ç”¨**çº¯è¿œç¨‹ MCPï¼ˆModel Context Protocolï¼‰æ¶æ„**ï¼š

- **MCP æœåŠ¡å™¨**ï¼ˆ`mcp_server.py`ï¼‰ï¼šæä¾›æ‰€æœ‰ä¸šåŠ¡èƒ½åŠ›ï¼ˆå–æ•°ã€ç®—æŒ‡æ ‡ã€ç”Ÿæˆæ´å¯Ÿç­‰ï¼‰
- **Agent**ï¼ˆ`agent.py`ï¼‰ï¼šä½œä¸ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡ MCP åè®®è°ƒç”¨æœåŠ¡å™¨èƒ½åŠ›
- **æ‰€æœ‰ä¸šåŠ¡é€»è¾‘**éƒ½åœ¨ MCP æœåŠ¡å™¨ç«¯ï¼ŒAgent åªè´Ÿè´£ç¼–æ’å’Œå¯¹è¯

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3 ç§è¿è¡Œæ–¹å¼ï¼‰

### æ–¹å¼ 1ï¼šæœ€ç®€å•çš„æµ‹è¯•ï¼ˆæ¨èæ–°æ‰‹ï¼‰

**æ­¥éª¤ 1ï¼šå®‰è£…ä¾èµ–**
```powershell
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd D:\BestSellers

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python -m venv .venv
.\.venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

**æ­¥éª¤ 2ï¼šè¿è¡Œé›†æˆæµ‹è¯•ï¼ˆä¼šè‡ªåŠ¨å¯åŠ¨ MCP æœåŠ¡å™¨å¹¶æµ‹è¯•ï¼‰**
```powershell
python operations_dashboard/test.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- è‡ªåŠ¨å¯åŠ¨ MCP æœåŠ¡å™¨ï¼ˆstdio æ¨¡å¼ï¼‰
- æµ‹è¯•æ‰€æœ‰å·¥å…·è°ƒç”¨
- æµ‹è¯• Agent å®Œæ•´æµç¨‹
- éªŒè¯æ•°æ®æŒä¹…åŒ–

**é¢„æœŸè¾“å‡ºï¼š**
```
[stdio] å·¥å…·=6, èµ„æº=2, æç¤ºé›†=2
[tools] é€šè¿‡ MCP æ¡¥æ‰§è¡Œå·¥å…·å¹¶éªŒè¯æŒä¹…åŒ–
[agent] å·²å®Œæˆæ¼”ç¤ºäº¤äº’ï¼Œæœ€åå›å¤å†…å®¹: ...
å…¨éƒ¨æ£€æµ‹é€šè¿‡
```

---

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨å¯åŠ¨ MCP æœåŠ¡å™¨ + Agentï¼ˆæ¨èç†è§£æ¶æ„ï¼‰

**æ­¥éª¤ 1ï¼šå‡†å¤‡ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼Œç”¨äºçœŸå®æ•°æ®ï¼‰**
```powershell
# è®¾ç½® OpenAI API Keyï¼ˆç”¨äºç”Ÿæˆæ´å¯Ÿï¼‰
$env:OPENAI_API_KEY = "sk-..."

# è®¾ç½® Amazon PAAPI å‡­è¯ï¼ˆç”¨äºæŸ¥è¯¢ç•…é”€æ¦œï¼Œå¯é€‰ï¼‰
$env:AMAZON_ACCESS_KEY = "your-access-key"
$env:AMAZON_SECRET_KEY = "your-secret-key"
$env:AMAZON_MARKETPLACE = "US"

# å¯ç”¨å­˜å‚¨ï¼ˆå¯é€‰ï¼Œç”¨äºä¿å­˜å†å²æ•°æ®ï¼‰
$env:STORAGE_ENABLED = "1"
$env:STORAGE_DB_PATH = "operations_dashboard.sqlite3"
```

**æ­¥éª¤ 2ï¼šå¯åŠ¨ MCP æœåŠ¡å™¨ï¼ˆç»ˆç«¯ Aï¼‰**
```powershell
# stdio æ¨¡å¼ï¼ˆAgent ä¼šè‡ªåŠ¨è¿æ¥ï¼‰
python -m operations_dashboard.mcp_server stdio

# æˆ–è€… HTTP æ¨¡å¼ï¼ˆå¯ä»¥ç”¨æµè§ˆå™¨è®¿é—®ï¼‰
python -m operations_dashboard.mcp_server streamable-http --host 127.0.0.1 --port 8000
```

**æ­¥éª¤ 3ï¼šè¿è¡Œ Agentï¼ˆç»ˆç«¯ Bï¼Œæ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼‰**
```powershell
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
.\.venv\Scripts\activate

# è¿è¡Œ Agent æ¼”ç¤º
python -c "from operations_dashboard.agent import run_agent_demo; from operations_dashboard.config import AppConfig, AmazonCredentialConfig, DashboardConfig, StorageConfig; config = AppConfig(amazon=AmazonCredentialConfig(access_key='mock', secret_key='mock'), dashboard=DashboardConfig(), storage=StorageConfig()); result = run_agent_demo(config, 'ç”Ÿæˆæœ€è¿‘7å¤©çš„è¿è¥æ—¥æŠ¥'); print(result['messages'][-1].content)"
```

æˆ–è€…åˆ›å»ºä¸€ä¸ªç®€å•çš„è„šæœ¬ `run_agent.py`ï¼š
```python
from operations_dashboard.agent import run_agent_demo
from operations_dashboard.config import AppConfig, AmazonCredentialConfig, DashboardConfig, StorageConfig

config = AppConfig(
    amazon=AmazonCredentialConfig(access_key="mock", secret_key="mock"),
    dashboard=DashboardConfig(),
    storage=StorageConfig(),
)

result = run_agent_demo(config, "ç”Ÿæˆæœ€è¿‘7å¤©çš„è¿è¥æ—¥æŠ¥å¹¶ç»™å‡ºå…³é”®æ´å¯Ÿ")
print("\n=== Agent å›å¤ ===")
print(result['messages'][-1].content)
```

ç„¶åè¿è¡Œï¼š
```powershell
python run_agent.py
```

---

### æ–¹å¼ 3ï¼šä½¿ç”¨ MCP Inspectorï¼ˆå¯è§†åŒ–è°ƒè¯•ï¼‰

**æ­¥éª¤ 1ï¼šå¯åŠ¨ HTTP æ¨¡å¼çš„ MCP æœåŠ¡å™¨**
```powershell
python -m operations_dashboard.mcp_server streamable-http --host 127.0.0.1 --port 8000
```

**æ­¥éª¤ 2ï¼šå¯åŠ¨ MCP Inspector**
```powershell
# ä½¿ç”¨ npxï¼ˆéœ€è¦ Node.jsï¼‰
npx @modelcontextprotocol/inspector

# æˆ–è€…å¦‚æœå·²å®‰è£… mcp CLI
mcp inspector
```

**æ­¥éª¤ 3ï¼šåœ¨æµè§ˆå™¨ä¸­è¿æ¥**
1. æ‰“å¼€ Inspector æ˜¾ç¤ºçš„ URLï¼ˆé€šå¸¸æ˜¯ `http://localhost:5173`ï¼‰
2. å¡«å†™è¿æ¥ä¿¡æ¯ï¼š
   - **Server URL**: `http://127.0.0.1:8000/mcp`
   - **Proxy Token**: ç•™ç©º
3. ç‚¹å‡» **Connect**
4. åœ¨å·¦ä¾§é¢æ¿å¯ä»¥ï¼š
   - æŸ¥çœ‹æ‰€æœ‰å·¥å…·ï¼ˆToolsï¼‰
   - æŸ¥çœ‹æ‰€æœ‰èµ„æºï¼ˆResourcesï¼‰
   - æŸ¥çœ‹æ‰€æœ‰æç¤ºæ¨¡æ¿ï¼ˆPromptsï¼‰
   - ç›´æ¥è°ƒç”¨å·¥å…·æµ‹è¯•

---

## ğŸ”§ è¯¦ç»†é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡å®Œæ•´åˆ—è¡¨

| å˜é‡å | è¯´æ˜ | å¿…éœ€ | é»˜è®¤å€¼ |
|--------|------|------|--------|
| `OPENAI_API_KEY` | OpenAI API å¯†é’¥ï¼Œç”¨äºç”Ÿæˆæ´å¯Ÿ | å¦ï¼ˆä½†ç”Ÿæˆæ´å¯Ÿæ—¶éœ€è¦ï¼‰ | - |
| `AMAZON_ACCESS_KEY` | Amazon PAAPI è®¿é—®å¯†é’¥ | å¦ï¼ˆæŸ¥è¯¢ç•…é”€æ¦œæ—¶éœ€è¦ï¼‰ | - |
| `AMAZON_SECRET_KEY` | Amazon PAAPI å¯†é’¥ | å¦ï¼ˆæŸ¥è¯¢ç•…é”€æ¦œæ—¶éœ€è¦ï¼‰ | - |
| `AMAZON_MARKETPLACE` | å¸‚åœºä»£ç ï¼ˆUS/UK/JPç­‰ï¼‰ | å¦ | US |
| `STORAGE_ENABLED` | æ˜¯å¦å¯ç”¨ SQLite å­˜å‚¨ | å¦ | 0 |
| `STORAGE_DB_PATH` | SQLite æ•°æ®åº“è·¯å¾„ | å¦ | operations_dashboard.sqlite3 |
| `USE_MCP_BRIDGE` | Agent æ˜¯å¦ä½¿ç”¨ MCP æ¡¥æ¥ | å¦ | 1ï¼ˆå·²å¼ºåˆ¶ï¼‰ |
| `MCP_SERVER_LOG_LEVEL` | MCP æœåŠ¡å™¨æ—¥å¿—çº§åˆ« | å¦ | INFO |

### MCP æœåŠ¡å™¨å¯åŠ¨å‚æ•°

```powershell
# stdio æ¨¡å¼ï¼ˆé»˜è®¤ï¼ŒAgent è‡ªåŠ¨è¿æ¥ï¼‰
python -m operations_dashboard.mcp_server stdio

# HTTP æ¨¡å¼ï¼ˆå¯ä»¥æµè§ˆå™¨è®¿é—®ï¼‰
python -m operations_dashboard.mcp_server streamable-http --host 127.0.0.1 --port 8000

# SSE æ¨¡å¼ï¼ˆæ—§ç‰ˆï¼Œä¸æ¨èï¼‰
python -m operations_dashboard.mcp_server sse --host 127.0.0.1 --port 8000
```

---

## ğŸ“ å¸¸ç”¨æ“ä½œç¤ºä¾‹

### 1. æµ‹è¯•å•ä¸ªå·¥å…·è°ƒç”¨

åˆ›å»º `test_tool.py`ï¼š
```python
import asyncio
import os
import sys
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    params = StdioServerParameters(
        command=sys.executable,
        args=["-m", "operations_dashboard.mcp_server", "stdio"],
        env={"OPENAI_API_KEY": os.getenv("OPENAI_API_KEY", "")},
    )
    async with stdio_client(params) as (read, write):
        async with ClientSession(read, write) as session:
            await session.initialize()
            
            # è°ƒç”¨ fetch_dashboard_data å·¥å…·
            result = await session.call_tool("fetch_dashboard_data", {"window_days": 7})
            print("ç»“æœ:", result.structuredContent)

if __name__ == "__main__":
    asyncio.run(main())
```

è¿è¡Œï¼š
```powershell
python test_tool.py
```

### 2. æŸ¥çœ‹å¯ç”¨çš„å·¥å…·å’Œèµ„æº

åˆ›å»º `list_capabilities.py`ï¼š
```python
import asyncio
import sys
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    params = StdioServerParameters(
        command=sys.executable,
        args=["-m", "operations_dashboard.mcp_server", "stdio"],
    )
    async with stdio_client(params) as (read, write):
        async with ClientSession(read, write) as session:
            await session.initialize()
            
            # åˆ—å‡ºæ‰€æœ‰å·¥å…·
            tools = await session.list_tools()
            print("=== å¯ç”¨å·¥å…· ===")
            for tool in tools.tools:
                print(f"- {tool.name}: {tool.description}")
            
            # åˆ—å‡ºæ‰€æœ‰èµ„æº
            resources = await session.list_resources()
            print("\n=== å¯ç”¨èµ„æº ===")
            for resource in resources.resources:
                print(f"- {resource.uri}: {resource.name}")
            
            # åˆ—å‡ºæ‰€æœ‰æç¤ºæ¨¡æ¿
            prompts = await session.list_prompts()
            print("\n=== å¯ç”¨æç¤ºæ¨¡æ¿ ===")
            for prompt in prompts.prompts:
                print(f"- {prompt.name}: {prompt.description}")

if __name__ == "__main__":
    asyncio.run(main())
```

### 3. ä½¿ç”¨æç¤ºæ¨¡æ¿

åˆ›å»º `use_prompt.py`ï¼š
```python
import asyncio
import sys
from mcp import ClientSession, StdioServerParameters
from mcp.client.stdio import stdio_client

async def main():
    params = StdioServerParameters(
        command=sys.executable,
        args=["-m", "operations_dashboard.mcp_server", "stdio"],
    )
    async with stdio_client(params) as (read, write):
        async with ClientSession(read, write) as session:
            await session.initialize()
            
            # è·å–"è¿è¥æ—¥æŠ¥"æç¤ºæ¨¡æ¿
            prompt = await session.get_prompt(
                "daily_operations_report_prompt",
                arguments={"marketplace": "US", "window_days": 7}
            )
            print("æç¤ºæ¨¡æ¿å†…å®¹:")
            for msg in prompt.messages:
                print(f"[{msg.role}]: {msg.content}")

if __name__ == "__main__":
    asyncio.run(main())
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šAgent æŠ¥é”™ "MCP tool 'xxx' failed"

**åŸå› **ï¼šMCP æœåŠ¡å™¨æ²¡æœ‰è¿è¡Œæˆ–è¿æ¥å¤±è´¥

**è§£å†³**ï¼š
1. ç¡®ä¿ MCP æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆç»ˆç«¯ Aï¼‰
2. æ£€æŸ¥ `USE_MCP_BRIDGE` ç¯å¢ƒå˜é‡æ˜¯å¦ä¸º `1`
3. æ£€æŸ¥ `MCP_BRIDGE_COMMAND` å’Œ `MCP_BRIDGE_ARGS` æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 2ï¼š`generate_dashboard_insights` æŠ¥é”™ç¼ºå°‘ API Key

**åŸå› **ï¼šæ²¡æœ‰è®¾ç½® `OPENAI_API_KEY`

**è§£å†³**ï¼š
```powershell
$env:OPENAI_API_KEY = "sk-your-key-here"
# ç„¶åé‡å¯ MCP æœåŠ¡å™¨
```

### é—®é¢˜ 3ï¼šHTTP æ¨¡å¼è¿æ¥å¤±è´¥ï¼ˆ405 æˆ– CORS é”™è¯¯ï¼‰

**åŸå› **ï¼šç«¯å£è¢«å ç”¨æˆ– URL ä¸æ­£ç¡®

**è§£å†³**ï¼š
1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -ano | findstr :8000`
2. ç¡®è®¤æœåŠ¡å™¨å¯åŠ¨æ—¶ä½¿ç”¨çš„ `--host` å’Œ `--port` å‚æ•°
3. ç¡®è®¤ Inspector ä¸­å¡«å†™çš„ URL æ˜¯ `http://127.0.0.1:8000/mcp`ï¼ˆæ³¨æ„ `/mcp` åç¼€ï¼‰

### é—®é¢˜ 4ï¼šå¯¼å…¥é”™è¯¯ "No module named 'operations_dashboard'"

**åŸå› **ï¼šPython è·¯å¾„é—®é¢˜

**è§£å†³**ï¼š
```powershell
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd D:\BestSellers

# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
.\.venv\Scripts\activate

# ä½¿ç”¨æ¨¡å—æ–¹å¼è¿è¡Œ
python -m operations_dashboard.mcp_server
```

---

## ğŸ“š é¡¹ç›®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

- **`mcp_server.py`**ï¼šMCP æœåŠ¡å™¨ï¼Œæä¾›æ‰€æœ‰ä¸šåŠ¡èƒ½åŠ›
- **`agent.py`**ï¼šLangGraph Agentï¼Œé€šè¿‡ MCP è°ƒç”¨æœåŠ¡å™¨èƒ½åŠ›
- **`mcp_bridge.py`**ï¼šMCP å®¢æˆ·ç«¯æ¡¥æ¥ï¼ŒAgent ç”¨æ¥è¿æ¥æœåŠ¡å™¨
- **`skills/`**ï¼šæŠ€èƒ½æŠ½è±¡å±‚ï¼ˆæœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼‰
- **`services.py`**ï¼šä¸šåŠ¡é€»è¾‘å®ç°ï¼ˆæœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼‰

### æµ‹è¯•å’Œå·¥å…·æ–‡ä»¶

- **`test.py`**ï¼šé›†æˆæµ‹è¯•è„šæœ¬
- **`call_insights_tool.py`**ï¼šç®€å•çš„å·¥å…·è°ƒç”¨ç¤ºä¾‹
- **`verify_amazon_keys.py`**ï¼šéªŒè¯ Amazon å‡­è¯

---

## ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ 

1. **ç†è§£ MCP åè®®**ï¼šæŸ¥çœ‹ `MCP_README.md` äº†è§£ MCP çš„è¯¦ç»†è§„èŒƒ
2. **æŸ¥çœ‹æœåŠ¡å™¨ä»£ç **ï¼šé˜…è¯» `mcp_server.py` äº†è§£å¦‚ä½•å®šä¹‰å·¥å…·å’Œèµ„æº
3. **æŸ¥çœ‹ Agent ä»£ç **ï¼šé˜…è¯» `agent.py` äº†è§£å¦‚ä½•é€šè¿‡ MCP è°ƒç”¨å·¥å…·
4. **æ‰©å±•åŠŸèƒ½**ï¼šåœ¨ `skills/dashboard.py` ä¸­æ·»åŠ æ–°çš„æŠ€èƒ½

---

## ğŸ’¡ æç¤º

- **å¼€å‘æ—¶**ï¼šä½¿ç”¨ `test.py` å¿«é€ŸéªŒè¯åŠŸèƒ½
- **è°ƒè¯•æ—¶**ï¼šä½¿ç”¨ MCP Inspector å¯è§†åŒ–æŸ¥çœ‹å·¥å…·è°ƒç”¨
- **ç”Ÿäº§æ—¶**ï¼šä½¿ç”¨ HTTP æ¨¡å¼éƒ¨ç½²ï¼ŒAgent é€šè¿‡ HTTP è¿æ¥
- **æµ‹è¯•æ—¶**ï¼šä½¿ç”¨ Mock æ•°æ®ï¼ˆä¸è®¾ç½® Amazon å‡­è¯ï¼‰å¿«é€ŸéªŒè¯æµç¨‹
